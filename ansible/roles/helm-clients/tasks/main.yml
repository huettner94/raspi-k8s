- name: Install MetalLB
  helm_cli:
    name: metallb
    state: present
    chart_ref: stable/metallb
    release_namespace: kube-system
    tiller_namespace: kube-system
    values:
      configInline:
        address-pools:
        - name: default
          protocol: layer2
          addresses:
          - 10.0.128.20-10.0.128.25
  when: k8s_root

- name: Install traefik
  helm_cli:
    name: traefik
    state: present
    chart_ref: stable/traefik
    release_namespace: kube-system
    tiller_namespace: kube-system
    values:
      rbac:
        enabled: true
      dashboard:
        enabled: true
        domain: traefik.apps.huettner.local
      ssl:
        enabled: true
        generateTLS: true
        defaultCN: apps.huettner.local
        defaultSANList:
          - "*.apps.huettner.local"
  when: k8s_root

- name: Install kubernetes-dashboard
  helm_cli:
    name: kubernetes-dashboard
    state: present
    chart_ref: stable/kubernetes-dashboard
    release_namespace: kube-system
    tiller_namespace: kube-system
    values:
      image:
        repository: k8s.gcr.io/kubernetes-dashboard-arm
      ingress:
        enabled: true
        hosts:
          - dashboard.apps.huettner.local
  when: k8s_root

- name: Install rook operator
  helm_cli:
    name: rook
    state: present
    chart_repo_url: "https://charts.rook.io/release"
    chart_ref:  rook-ceph
    release_namespace: rook
    tiller_namespace: kube-system
  when: k8s_root
